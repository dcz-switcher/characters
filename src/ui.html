<style>
  *{
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
  }

  .skin-color1{ background-color: #5396FA; }
  .skin-color2{ background-color: #FFCF37; }
  .skin-color3{ background-color: #F6D3B5; }
  .skin-color4{ background-color: #F3C09A; }
  .skin-color5{ background-color: #916441; }
  .skin-color6{ background-color: #402E23; }


  #container{
    display: flex;
    flex-direction: column;
    background-color: #fff;
    color: white;
    width: 330px;
    height: 100%;
    margin: 0;
    padding: 0;
  }

  #builder{
    display: flex;
    border-bottom: 1px solid #E5E5E5;
    padding: 16px;
  }

  #menu{ width: 140px; }


  #menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #menu li {
    color: #B0B0B0;
    line-height: 22px;
    font-size: 18px;
    font-weight: normal;
  }

  #menu a {
    display: flex;
    text-decoration: none;
    color: #B0B0B0;
    padding: 4px 4px 4px 0;
  }

  #menu a:hover{ font-weight: bold; font-size: 20px; }
  #menu a.selected{ color: #5396FA; font-weight: bold; font-size: 20px; cursor: default;}
  

  #preview{
    display: flex;
    align-items: center;
    justify-content: center;
    width: 190px;
  }

  #layer-stack{
    position: relative;
    width: 98px;
    height: 108px;
  }

  .layer{
    position: absolute;
    top: 0;
    left: 0;
  }

  #eyes-layer{
    top: 30px;
    left: 18px;
  }

  #mouth-layer{
    top: 66px;
    left: 18px;
  }






  #panels #panel-stack{
    position: relative;
  }

  #panel-stack .panel{
    position: absolute;
    top:0;
    left: 0;
    width: 100%;
    box-sizing: border-box;
    display: none;
    padding: 16px;
  }

  #panel-stack .panel.selected{
    display: block;
  }
  
  
  /* RADIO SHAPE */
  .radio-shape-group{
    display: flex;
    flex-wrap: wrap;
  }
  .radio-shape{position: relative; box-sizing: border-box; margin: 0 14px 14px 0;}
  .radio-shape input[type=radio]{display: none;}
  .radio-shape label{
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }
  .radio-shape .shape{
    display: flex;
    position: relative;
    justify-content: center;
    align-items: center
  }
  .radio-shape .shape::after{
    display: block;
    position: absolute;
    content: '';
  }
  
  .radio-shape input[type=radio]:checked ~ .shape::after{
    border: 4px solid #5A5A5F;
  }

  .radio-shape.circle .shape{
    width: 36px;
    height: 36px;
    border-radius: 100%;
  }
  .radio-shape.circle .shape::after{
    width: 46px;
    height: 46px;
    top: -9px;
    left: -9px;
    border-radius: 100%;
  }
  .radio-shape.rectangle .shape{
    width: 68px;
    height: 48px;
    border-radius: 4px;
  }
  .radio-shape.rectangle .shape::after{
    width: 78px;
    height: 58px;
    top: -9px;
    left: -9px;
    border-radius: 6px;
  }
  
  .radio-shape.square .shape{
    width: 48px;
    height: 48px;
    border-radius: 4px;
  }
  .radio-shape.square .shape::after{
    width: 58px;
    height: 58px;
    top: -9px;
    left: -9px;
    border-radius: 6px;    
  }

  



  #colors{
    display: flex;
    justify-content: space-between;
  }

  .color-circle{
    width: 36px;
    height: 36px;
    border-radius: 100%;
    cursor: pointer;    
  }

  .radio-wrap{
    position: relative;
  }

  #colors input[type=radio]{
    display: none;
  }

  #colors label{
    width: 36px;
    height: 36px;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
    cursor: pointer;
  }

  .radio-skin{
    display: block;
    position: relative;
    width: 36px;
    height: 36px;
    border-radius: 100%;
  }

  .radio-skin::after{
    display: block;
    position: relative;
    content: '';
    width: 46px;
    height: 46px;
    top: -9px;
    left: -9px;
    border-radius: 100%;
  }

  #colors input[type=radio]:checked ~ .radio-skin::after{
    border: 4px solid #5A5A5F;
  }

  /* special for panel with preview copy scaled */
  #hair-panel .layer-stack-copy{
    transform: scale(0.5);
    transform-origin: left;
  }


  #actions{
    padding: 16px;
    height: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: flex-end;
  }

  button {
    height: 30px;
    box-sizing: border-box;
    border-radius: 6px;
    font-style: normal;
    font-size: 13px;
    text-align: center;
    border: none;
    cursor: pointer;
    padding: 8px 12px;
  }

  .btn-primary{
    background: #18A0FB;
    color: white;
  }

  .btn-ghost{
    border: 1px solid rgba(255, 255, 255, 0.8);
    color: white;
    background: none;
  }
 
</style>

<div id="container">

  <section id="builder">
    <div id="menu">
      <ul>
        <li><a href="#skin-panel" class="selected">Skin</a></li>
        <li><a href="#eyes-panel">Eyes</a></li>
        <li><a href="#mouth-panel">Mouth</a></li>
        <li><a href="#hair-panel">Hair</a></li>
        <li><a href="#facehairs-panel">Face Hairs</a></li>
        <li><a href="#clothes-panel">Clothes</a></li>
        <li><a href="#accessories-panel">Accessories</a></li>
      </ul>
    </div>
    <div id="preview">
      <div id="layer-stack">
        <div class="layer" id="head-layer"></div>
        <div class="layer" id="eyes-layer"></div>
        <div class="layer" id="mouth-layer"></div>
      </div>
    </div>
  </section>
  
  <section id="panels">
    <div id="panel-stack">
<!-- SKIN PANEL-->
      <div id="skin-panel" class="panel ">
        <div id="colors">
          <div class="radio-wrap">
            <input type="radio" id="color-1" name="skin-color" value="#5396FA">
            <label for="color-1"></label>
            <div class="radio-skin skin-color1"></div>
          </div>
          <div class="radio-wrap">
            <input type="radio" id="color-2" name="skin-color" value="#FFCF37">
            <label for="color-2"></label>
            <div class="radio-skin skin-color2"></div>
          </div>
          <div class="radio-wrap">
            <input type="radio" id="color-3" name="skin-color" value=" #F6D3B5">
            <label for="color-3"></label>
            <div class="radio-skin skin-color3"></div>
          </div>
          <div class="radio-wrap">
            <input type="radio" id="color-4" name="skin-color" checked="checked" value="#F3C09A">
            <label for="color-4"></label>
            <div class="radio-skin skin-color4"></div>
          </div>
          <div class="radio-wrap">
            <input type="radio" id="color-5" name="skin-color" value="#916441">
            <label for="color-5"></label>
            <div class="radio-skin skin-color5"></div>
          </div>
          <div class="radio-wrap">
            <input type="radio" id="color-6" name="skin-color" value=" #402E23">
            <label for="color-6"></label>
            <div class="radio-skin skin-color6"></div>
          </div>
        </div>
      </div>

<!-- EYES PANEL-->
      <div id="eyes-panel" class="panel">
        <div id="eyes-radios" class="radio-shape-group">

          <div class="radio-shape rectangle">
            <input type="radio" id="eyes-1" name="eye-shape" value="1" checked="checked">
            <label for="eyes-1"></label>
            <div class="shape skin-color4"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="eyes-2" name="eye-shape" value="2">
            <label for="eyes-2"></label>
            <div class="shape skin-color4"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="eyes-3" name="eye-shape" value="3">
            <label for="eyes-3"></label>
            <div class="shape skin-color4"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="eyes-4" name="eye-shape" value="4">
            <label for="eyes-4"></label>
            <div class="shape skin-color4"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="eyes-5" name="eye-shape" value="5">
            <label for="eyes-5"></label>
            <div class="shape skin-color4"></div>
          </div>

        </div>
      </div>

<!-- MOUTH PANEL-->      
      <div id="mouth-panel" class="panel">
        <div class="radio-shape-group">
          <div class="radio-shape rectangle">
            <input type="radio" id="mouth-1" name="mouth-shape" value="1" checked="checked">
            <label for="mouth-1"></label>
            <div class="shape skin-color4"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="mouth-2" name="mouth-shape" value="2">
            <label for="mouth-2"></label>
            <div class="shape skin-color4"></div>
          </div>
        </div>
      </div>

<!-- HAIR PANEL -->
      <div id="hair-panel" class="panel selected">
        <div class="radio-shape-group">
          
          <div class="radio-shape square">
            <input type="radio" id="hair-1" name="shape" value="1" checked="checked">
            <label for="hair-1"></label>
            <div class="shape skin-color2"></div>
          </div>
          
          <div class="radio-shape square">
            <input type="radio" id="hair-2" name="shape" value="2">
            <label for="hair-2"></label>
            <div class="shape skin-color2"></div>
          </div>

        </div>
      </div>

<!-- SHAPE PANEL -->
      <div id="shape-panel" class="panel">
        <div class="radio-shape-group">
          
          <div class="radio-shape circle">
            <input type="radio" id="circle-1" name="shape" value="1">
            <label for="circle-1"></label>
            <div class="shape skin-color6"></div>
          </div>
          <div class="radio-shape square">
            <input type="radio" id="square-2" name="shape" value="2">
            <label for="square-2"></label>
            <div class="shape skin-color2"></div>
          </div>
          <div class="radio-shape rectangle">
            <input type="radio" id="rectangle-3" name="shape" value="3">
            <label for="rectangle-3"></label>
            <div class="shape skin-color5"></div>
          </div>

        </div>
      </div>
    </div>
  </section>
  
  <section id="actions">
    <button id="create" class="btn-primary">Create character</button>
  </section>


</div>



<script>

  //const HEAD = '<svg width="98" height="108" viewBox="0 0 98 108" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.0182 39.0711C10.0182 17.4927 27.511 0 49.0894 0C70.6678 0 88.1605 17.4927 88.1605 39.0711V40.3612C93.6109 40.4564 98 44.8964 98 50.3596C98 55.8229 93.6109 60.2629 88.1605 60.3581V68.9289C88.1605 90.5073 70.6678 108 49.0894 108C27.511 108 10.0182 90.5073 10.0182 68.9289V60C4.48532 60 0 55.5228 0 50C0 44.4772 4.48532 40 10.0182 40V39.0711Z" fill="#F3C09A"/></svg>';
  const HEAD = '<svg width="98" height="108" viewBox="0 0 98 108" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.0182 39.0711C10.0182 17.4927 27.511 0 49.0894 0C70.6678 0 88.1605 17.4927 88.1605 39.0711V40.0013C93.6093 40.087 98 44.5308 98 50C98 55.4692 93.6093 59.913 88.1605 59.9987V68.9289C88.1605 90.5073 70.6678 108 49.0894 108C27.511 108 10.0182 90.5073 10.0182 68.9289V60C10.0122 60 10.0061 60 10 60C4.47715 60 0 55.5228 0 50C0 44.4772 4.47715 40 10 40C10.0061 40 10.0122 40 10.0182 40V39.0711Z" fill="#F3C09A"/></svg>';
  const EYE_1 = '<svg width="62" height="36" viewBox="0 0 62 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5.11731" y="1.70374" width="22" height="32" rx="11" fill="white"/><rect x="36" y="2" width="22" height="32" rx="11" fill="white"/><rect x="13.0432" y="9.62964" width="10" height="16" rx="5" fill="#434243"/><rect x="39.963" y="9.9259" width="10" height="16" rx="5" fill="#434243"/></svg>';
  const EYE_2 = '<svg width="62" height="36" viewBox="0 0 62 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.11731 18V22.7037C5.11731 28.7789 10.0422 33.7037 16.1173 33.7037C22.1924 33.7037 27.1173 28.7789 27.1173 22.7037V18H5.11731Z" fill="white"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.0432 18V20.6296C13.0432 23.3911 15.2818 25.6296 18.0432 25.6296C20.8046 25.6296 23.0432 23.3911 23.0432 20.6296V18H13.0432Z" fill="#434243"/><path fill-rule="evenodd" clip-rule="evenodd" d="M36 18V23C36 29.0751 40.9249 34 47 34C53.0751 34 58 29.0751 58 23V18H36Z" fill="white"/><path fill-rule="evenodd" clip-rule="evenodd" d="M39.963 18V20.9259C39.963 23.6873 42.2016 25.9259 44.963 25.9259C47.7244 25.9259 49.963 23.6873 49.963 20.9259V18H39.963Z" fill="#434243"/></svg>';
  const MOUTH_1 = '<svg width="62" height="36" viewBox="0 0 62 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M50.6623 16.0132L51.503 13.4911C51.7345 12.7966 51.1659 12.097 50.4388 12.1815L35.12 13.9628C32.0504 14.3197 28.9496 14.3197 25.88 13.9628L10.6195 12.1883C9.87815 12.1021 9.30705 12.829 9.56627 13.5289L10.8698 17.0484C12.8602 22.4226 17.0604 26.6847 22.4049 28.7535L22.7858 28.901C27.1256 30.5809 31.9154 30.6949 36.3302 29.2233L38.0132 28.6623C43.9853 26.6716 48.6716 21.9853 50.6623 16.0132Z" fill="white"/></svg>';
  const MOUTH_2 = '<svg width="62" height="36" viewBox="0 0 62 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M44.7107 15.964C45.2829 16.9089 44.9807 18.1386 44.0359 18.7108L43.0112 19.3313C34.9163 24.2331 24.7074 23.9688 16.8769 18.6549C15.9629 18.0347 15.7248 16.7909 16.345 15.8769C16.9653 14.963 18.209 14.7248 19.123 15.3451C25.6597 19.781 34.1819 20.0016 40.9393 15.9097L41.964 15.2892C42.9088 14.7171 44.1386 15.0192 44.7107 15.964Z" fill="#AB5A41"/></svg>';
  const HAIR_1 = '<svg width="91" height="41" viewBox="0 0 91 41" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M27.0021 32.2008C24.9376 37.3576 19.8942 41 14 41C6.26801 41 0 34.732 0 27C0 19.268 6.26801 13 14 13C15.8907 13 17.6938 13.3748 19.3392 14.0541C20.9396 6.03933 28.0145 0 36.5 0H73.5C83.165 0 91 7.83502 91 17.5C91 27.165 83.165 35 73.5 35H36.5C32.9987 35 29.7376 33.9718 27.0021 32.2008Z" fill="black"/></svg>';

  const EYES = [null, EYE_1, EYE_2];
  const MOUTHS = [null, MOUTH_1, MOUTH_2];
  const HAIRS = [null, HAIR_1];

  const character = {
    skin : 4,
    eyes: 1,
    mouth: 1,
    hair: 0
  };


  const $menu = document.querySelector('#menu ul');
  
  const $layerStack = document.querySelector('#preview');
  const $headLayer = $layerStack.querySelector('#head-layer');
  const $eyeLayer = $layerStack.querySelector('#eyes-layer');
  const $mouthLayer = $layerStack.querySelector('#mouth-layer');
  
  const $panelStack = document.querySelector('#panel-stack');
  const $eyesPanel = $panelStack.querySelector('#eyes-panel');
  const $mouthPanel = $panelStack.querySelector('#mouth-panel');
  const $hairPanel = $panelStack.querySelector('#hair-panel');

  
  /** Initialization */
  document.addEventListener('DOMContentLoaded', () => {
    // initialization avatar preview layers
    $headLayer.innerHTML = HEAD;
    $eyeLayer.innerHTML = EYES[character.eyes];
    $mouthLayer.innerHTML = MOUTHS[character.mouth];
    
    // initization eyes panel
    $eyesPanel.querySelector('#eyes-1 ~ .shape').innerHTML = EYES[1];
    $eyesPanel.querySelector('#eyes-2 ~ .shape').innerHTML = EYES[2];

    // initialization mouth panel
    $mouthPanel.querySelector('#mouth-1 ~ .shape').innerHTML = MOUTHS[1];
    $mouthPanel.querySelector('#mouth-2 ~ .shape').innerHTML = MOUTHS[2];

    // initialization hair panel
    $hairPanel.querySelector('#hair-1 ~ .shape').innerHTML = $layerStack.innerHTML;
    //todo 
    // must change div id from layer-stack to '' 
    // and set class layer-stack-copy or layer-stack-preview
    // then css properties were apply (css transformation scale)
    $hairPanel.querySelector('#hair-2 ~ .shape').innerHTML = HEAD;
  });

/**
 * navigation
 */
  $menu.addEventListener('click', (e) => {
    if (e.target.tagName === 'A' 
      && e.target.href !== undefined
      && !e.target.classList.contains('selected')) {
        const href = e.target.href.substring(e.target.href.lastIndexOf('#')+1);
        try {
          if ($panelStack.querySelector('#' + href)){
            $panelStack.querySelector('.panel.selected').classList.remove('selected');
            $panelStack.querySelector('#' + href).classList.add('selected');

            $menu.querySelector('a.selected').classList.remove('selected');
            e.target.classList.add('selected');
          }
        }catch(e){
          console.log('error');
          console.log(e);
        }
    }
  });


  /**
   * Listen to EYE selection
   */ 
  $eyesPanel.addEventListener('change', (e) => {
    if(e.target.tagName === "INPUT" && e.target.name === "eye-shape"){
      try{
        character.eyes = parseInt(e.target.value);
        $eyeLayer.innerHTML = EYES[character.eyes];
      } catch(e){
        console.log(e);
      }
    }
  });


  /**
   * Listen to MOUTH selectio
   */
  $mouthPanel.addEventListener('change', (e) => {
    if (e.target.tagName === "INPUT" && e.target.name === "mouth-shape"){
      try{
        character.mouth = parseInt(e.target.value);
        $mouthLayer.innerHTML = MOUTHS[character.mouth];
      }catch(e){
        console.log(e);
      }
    }
  }); 


  /** Change head color */
  document.querySelectorAll("input[name='skin-color']").forEach((el) => {
    el.addEventListener('change', function() {
      $headLayer.firstChild.firstChild.setAttribute('fill', document.querySelector("input[name='skin-color']:checked").value);
    })
  });


  /** create avatar in Figma */
  document.getElementById('create').onclick = () => {
    /*
    const textbox = document.getElementById('count');
    const count = parseInt(textbox.value, 10);
    parent.postMessage({ pluginMessage: { type: 'create-rectangles', count } }, '*')
    */
    const skinColor = document.querySelector("input[name='skin-color']:checked").value;
    
    //parent.postMessage({ pluginMessage: { type: 'create-avatar', skinColor } }, '*');
    parent.postMessage({ pluginMessage: { type: 'create-character', character } }, '*');
  }
/*
  document.getElementById('cancel').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
  }
*/
</script>
